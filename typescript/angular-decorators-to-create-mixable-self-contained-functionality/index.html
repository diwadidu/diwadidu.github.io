<!DOCTYPE html><html lang="en-us"><head><meta name="generator" content="Hexo 3.9.0"><title>Angular Decorators to Create Mixable, Self-contained Functionality | Torsten Müller</title><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="description" content="In this post, I'm going to build on a previous post introducing TypeScript Decorators by building a mixable implementation to have two form communicate with each other and an embedding component."><meta name="author" content="Torsten Muller"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="128x128" href="/images/favicon-128.png"><link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-196x196.png"><meta name="msapplication-TileColor" content="#FFFFFF"><meta name="msapplication-TileImage" content="mstile-144x144.png"><meta name="msapplication-square70x70logo" content="mstile-70x70.png"><meta name="msapplication-square150x150logo" content="mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="mstile-310x150.png"><meta name="msapplication-square310x310logo" content="mstile-310x310.png"><link rel="alternate" href="/atom.xml" title="Torsten Müller" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="Torsten Müller" type="application/rss+xml">
<link rel="stylesheet" href="/css/prism-cb.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body itemscope itemtype="https://schema.org/WebPage"><header itemscope itemtype="https://schema.org/WPHeader"><div class="logo-container"><div id="crystal-container" class="logo"></div></div><h1>Torsten Müller<!--a(href= config.root, alt= config.title, title= config.title, itemprop='headline')= config.title--></h1><p itemprop="description"></p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/ " alt="Home" title="Home" itemprop="url">Home</a></li><li itemprop="name"><a href="/projects" alt="Projects" title="Projects" itemprop="url">Projects</a></li><li itemprop="name"><a href="/tags" alt="Topics" title="Topics" itemprop="url">Topics</a></li><li itemprop="name"><a href="/about-me" alt="About me" title="About me" itemprop="url">About me</a></li><li itemprop="name"><a href="/de/ueber-mich" alt="Auf Deutsch" title="Auf Deutsch" itemprop="url">Auf Deutsch</a></li></ul></nav><div class="space"></div></header><main itemscope itemtype="https://schema.org/Blog"><div class="story-container"><article class="full tag-list-root"><h1 itemprop="headline" class="post-heading">Angular Decorators to Create Mixable, Self-contained Functionality</h1><div class="publish-date left">published May 17th, 2020</div><div class="clear"><ul class="tag-list"><li class="badge"><a href="/tags/architecture" itemprop="url" class="architecture"><span>architecture</span></a></li><li class="badge"><a href="/tags/typescript" itemprop="url" class="typescript"><span>typescript</span></a></li><li class="badge"><a href="/tags/javascript" itemprop="url" class="javascript"><span>javascript</span></a></li></ul></div><span class="post-meta"></span><div id="toc"></div><p>In a previous post, I looked at <em>Decorators</em> and how they can be used to abstract often-used functionality, such as logging the parameters and results of method calls. In this post, I’ll extend that idea by creating a decorator set which works together to permit communication between individual form groups housed in individual components and the embedding component. Let’s start!</p>
<h2 id="The-Goal"><a href="#The-Goal" class="headerlink" title="The Goal"></a>The Goal</h2><p>To learn this technique, I came up with the somewhat out-there idea of creating form fragements that can be combined at will to create forms collecting different data. The form will look like the following screenshots, with the empty form on the left and the filled out form with an enabled <em>Submit</em> button on the right:</p>
<p><img src="./form-example.jpg" alt="Two screenshots of the finished form implementation."></p>
<p>The two screenshots show a form consisting of two sections with intentionally very simple forms as a means for demonstrating this simple example: One fom collects user information and one information about a (musical) band. The unspoken context to this is that the two forms are independent of each other and should remain so. This will increase their reusability, as the underlying data can be collected in many different contexts: User information for account users, other users and band information for favorites, a band ranking etc.</p>
<p>The goal, then, is to make these form fragments reusable and manage the overall state in the embedding component, which will, once all required data is entered correctly, enable a save button.</p>
<h2 id="The-Approach"><a href="#The-Approach" class="headerlink" title="The Approach"></a>The Approach</h2><p>In this post, I’m going to use a decorator which implements form synchronization called <code>@FormSync</code>, which will be added to each individual form as well as the containing form. Its purpose is to permit communication of form events to and from the forms to the embedding component. </p>
<h3 id="The-Templates"><a href="#The-Templates" class="headerlink" title="The Templates"></a>The Templates</h3><p>The actual page template consists of regular HTML, but embeds the individual form fragments, which are implemented as <em>Angular Components</em>. Since the overall state is managed in this, let’s call it “root component”, the buttons to clear and submit should also be located here — The individual form fragments only know about their own state. </p>
<p>So with these requirements, we can set up the following template, which embeds the components for the two form segements we want to use:</p>
<figcaption class="code-filename html">app.component.html</figcaption>

<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Decorator Example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>User<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-user-form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-user-form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Favorite Band<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-fave-band</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-fave-band</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>storeFormData($event)<span class="token punctuation">"</span></span> 
        <span class="token attr-name">[disabled]</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>!permitStoringForm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Save Data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clearFormContent()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Clear Form<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>I’ll get back to the bindings on the buttons later. For now, let’s take a look at one of the actual form templates, e.g. <code>UserFormComponent</code>, which collects the user data. It implements an Angular Form Group and is standard Angular:</p>
<figcaption class="code-filename html">user-form.component.html</figcaption>

<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span> <span class="token attr-name">[formGroup]</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userForm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-6 form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-form-label<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span>  
           <span class="token attr-name">(blur)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onFormFieldLeave($event)<span class="token punctuation">"</span></span>
           <span class="token attr-name">formControlName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-6 form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span>  
           <span class="token attr-name">(blur)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onFormFieldLeave($event)<span class="token punctuation">"</span></span>
           <span class="token attr-name">formControlName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The difference between this and the standard form implementation is the use and functionality of the <code>(blur)</code> event handler on the form fields, which is essential in this implementation to propagate changes in form values. </p>
<h3 id="The-Form’s-TypeScript-Controller"><a href="#The-Form’s-TypeScript-Controller" class="headerlink" title="The Form’s TypeScript Controller"></a>The Form’s TypeScript Controller</h3><p>The method passed to the <code>onBlur</code> event is responsible for collecting the form group’s data, determine its validity and pass it on to whoever aggregates the data. In this case — where the form groups are independent of a form instance — all the form’s data should go to the embedding component, i.e. the <em>root component</em>, whose job it is to aggregate the data.</p>
<p>Let’s look at an abdriged version of the form’s controller:</p>
<figcaption class="code-filename typescript">user-form.component.ts</figcaption>

<pre class="line-numbers language-typescript"><code class="language-typescript">@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span> selector<span class="token punctuation">:</span> <span class="token string">'app-user-form'</span><span class="token punctuation">,</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserFormComponent</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> userForm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fb<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span> Validators<span class="token punctuation">.</span>required<span class="token punctuation">]</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span> Validators<span class="token punctuation">.</span>required<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> fb<span class="token punctuation">:</span> FormBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">onFormFieldLeave</span><span class="token punctuation">(</span>formEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> formValue<span class="token punctuation">:</span> FormDataEntryEvent<span class="token operator">&lt;</span>UserType<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> FormEventType<span class="token punctuation">.</span>DATA_UPDATE<span class="token punctuation">,</span>
      id<span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
      isValid<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userForm<span class="token punctuation">.</span>valid<span class="token punctuation">,</span>
      formData<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userForm<span class="token punctuation">.</span><span class="token function">getRawValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitEvent</span><span class="token punctuation">(</span>formValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>There is the definition of the form group using the <em>Reactive Form</em> mechanosm provided by Angular and then the <code>onFormFieldLeave()</code> method we saw on the form element in the template.</p>
<p>The method only contains two instructions: </p>
<ul>
<li>The creation of an object of type <code>FormDataEntryEvent&lt;UserType&gt;</code>, which specifies a type and an ID as well as stores the current values on whether the form in the template is valid and what its entered data is (in <code>formData&#39;</code>).</li>
<li>The emission of that object by calling a thus far undefined <code>emitEvent()</code> method. </li>
</ul>
<p>And that’s where we <em>finall</em>y get to talk about the decorators. </p>
<h2 id="The-Decorators"><a href="#The-Decorators" class="headerlink" title="The Decorators"></a>The Decorators</h2><p>The problem to solve here is to synchronize data between components. There are multiple ways to do that, e.g. through event and property binding, or — more elaborate and completely disproportional for this use case, a State Store. In this post, I’m going to talk about Angular Decorators to accomplish that goal. They allow abstracting the form communication functionality and thus make it generally usable for many use cases.</p>
<p>As seen in the introductory post on <a href="../typescript-decorator-principles-use-cases/">TypeScript decorators</a>, they are simply functions which adhere to a certain interface, be it <code>ClassDecorator</code> or <code>MethodDecorator</code> and which can augment a class definition or wrap a method with custom functionality. </p>
<p>In this case, we want to use the same decorator to enable the exchange of information between multiple components. However, assigning a decorator to a class creates a new instance, so in order to be able to permit the exchange of ideas among mulitple classes, decorated with the same <code>@Decorator</code>, we need to reach into our functional programming box of tricks and use currying to achieve that goal in our class decorator.</p>
<h3 id="Creating-a-Sychronizing-Class-Decorator"><a href="#Creating-a-Sychronizing-Class-Decorator" class="headerlink" title="Creating a Sychronizing Class Decorator"></a>Creating a Sychronizing Class Decorator</h3><p>The following code creates the bones of a <em>Class Decorator</em> which includes the instantiation of an Rx.JS Subject on line 3. Through this <em>Subject</em>, which will be shared among all decorator instances, the communication between the various components is accomplished. The rest of the following code is simply boilerplate to set up the implementation of our custom class decorator called <code>@FormSync</code>:</p>
<figcaption class="code-filename typescript">form-sync.trait.ts</figcaption>

<pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> FormSync<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> ClassDecorator <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> eventSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token operator">&lt;</span>FormEvent<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">buildingBlockFunctionality</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ClassDecorator <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token keyword">constructor</span><span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>To get an idea of which functionality we’re going to build into the Decorator, the following is the interface for the decorator:</p>
<figcaption class="code-filename typescript">form-sync.interface.ts</figcaption>

<pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">FormSyncInterface</span> <span class="token punctuation">{</span>
  formEventStream<span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span><span class="token keyword">any</span><span class="token operator">></span><span class="token punctuation">;</span>
  onEvent<span class="token punctuation">:</span> <span class="token punctuation">(</span>fct<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  emitEvent<span class="token punctuation">:</span> <span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  clearForm<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">enum</span> FormEventType <span class="token punctuation">{</span>
  DATA_UPDATE <span class="token operator">=</span> <span class="token string">'FORM_DATA_UPDATE'</span><span class="token punctuation">,</span>
  CLEAR <span class="token operator">=</span> <span class="token string">'FORM_CLEAR'</span><span class="token punctuation">,</span>
  SUBMIT <span class="token operator">=</span> <span class="token string">'FORM_SUBMIT'</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>This interface defines the following functionality:</p>
<ol>
<li>We expose the <code>Subject</code> we just created to the outside as an Observable called <code>formEventStream</code></li>
<li>There will be an <code>onEvent</code> property on decorated classes, which will accept a function that then reacts to any events on the Observable/Subject</li>
<li>The <code>emitEvent</code> property, which we already saw in our component example, sending a data packet with form data to the Subject.</li>
<li>A <code>clearForm</code> method, which we will use to communicate from the embedding template to all the form templates to clear themselves.</li>
</ol>
<p>Also shown in the previous listing are the defined types for events that the system supports: The updating of data in the form, the clearing and of course the submission of the form data. We’ll see an example of this in a moment when it comes to resetting forms.</p>
<p>One of the important things we need to do is to send and receive events from the Rx Subject. For that purpose, we defined two methods on the interface, whose implementation looks like this (showing the implementation in the innermost function of the above skeleton):</p>
<figcaption class="code-filename typescript">form-sync.trait.ts</figcaption>

<pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token keyword">constructor</span><span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> eventSubscription<span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>formEventStream <span class="token operator">=</span> eventSubject<span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>onEvent <span class="token operator">=</span> 
    <span class="token keyword">function</span><span class="token punctuation">(</span>rxOnNext<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> FormDataEntryEvent<span class="token operator">&lt;</span><span class="token keyword">any</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>eventSubscription<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          eventSubscription <span class="token operator">=</span> <span class="token keyword">constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>formEventStream
          <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
             next<span class="token punctuation">:</span> rxOnNext
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
      <span class="token punctuation">}</span>    
      <span class="token punctuation">}</span>

  <span class="token keyword">constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>emitEvent <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    eventSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>On line 2, we create a property to store a subscription to the <code>Subject</code> we created previously. On line 4, we expose an Observable based on that Subject for the user to subscribe to as needed. But in order to make this implementation more user friendly, we also implement the <code>onEvent</code> and <code>emitEvent</code> interface methods.</p>
<p>With <code>onEvent</code>, we set up an event listener on the Observable, accepting a method that will be invoked whenever an Rx.js event occurs. The <code>emitEvent</code> method does the exact opposite, which is to create an <code>onNext</code> event on the Subject with the provided data. So these two methods are the core of this functionality and provide a means to relay events to mulitple listeners who can then react according to their business logic.</p>
<p>With the basics out of the way, let’s talk about two more methods that the class decorator has. The first we already saw in the interface is the <code>clearForm</code> method, which communicates <em>to</em> the subforms to clear themselves and the other is housekeeping, which unsubscribes from the observable when the decorated class gets unloaded/destroyed:</p>
<figcaption class="code-filename typescript">form-sync.trait.ts</figcaption>

<pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">const</span> sourceOnDestroy <span class="token operator">=</span> <span class="token keyword">constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>ngOnDestroy<span class="token punctuation">;</span>
<span class="token keyword">constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>ngOnDestroy <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>eventSubscription<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    eventSubscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    eventSubscription <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token operator">!</span><span class="token operator">!</span>sourceOnDestroy <span class="token operator">&amp;&amp;</span> sourceOnDestroy<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>clearForm <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>formEvent<span class="token punctuation">:</span> FormDataEntryEvent<span class="token operator">&lt;</span><span class="token keyword">any</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span> FormEventType<span class="token punctuation">.</span>CLEAR<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The first 9 lines implement the <code>OnDestroy</code> method, which stops the subscription and sets the reference to the subscription stored in that instance of the decorator to <code>null</code> before it calls any method defined on the Angular Component. </p>
<p>The <code>clearForm</code> method is straightforward in that it simply emits an event to the Subject, indicating to the forms to clear themselves.</p>
<h3 id="Reacting-to-Form-Events"><a href="#Reacting-to-Form-Events" class="headerlink" title="Reacting to Form Events"></a>Reacting to Form Events</h3><p>We can now rewrite the component class for the user form as follows (omitting already explained code):</p>
<figcaption class="code-filename typescript">user-form.component.ts</figcaption>

<pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">UserFormComponent</span> <span class="token keyword">extends</span> <span class="token class-name">FormSyncInterface</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
@<span class="token function">FormSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserFormComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> userForm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fb<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> fb<span class="token punctuation">:</span> FormBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onFormEvent<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">onFormFieldLeave</span><span class="token punctuation">(</span>formEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// as before</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">onFormEvent</span><span class="token punctuation">(</span>formEvent<span class="token punctuation">:</span> FormEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>formEvent<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> FormEventType<span class="token punctuation">.</span>DATA_UPDATE<span class="token punctuation">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> FormEventType<span class="token punctuation">.</span>CLEAR<span class="token punctuation">:</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resetting user form'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userForm<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> FormEventType<span class="token punctuation">.</span>SUBMIT<span class="token punctuation">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>There are a few things here:</p>
<ol>
<li>As <a href="../typescript-decorator-principles-use-cases/">described in the previous post</a>, to satisfy TypeScript’s typing mechanism, we need to declare an interface for the new component which extends the <code>FormSyncInterface</code> defined before (line 1)</li>
<li>We added the Decorator for <code>@FormSync()</code> before the class definition, thereby exposing all the decorator functionality in our component (line 4)</li>
<li>We are implementing the <code>onInit</code> interface, in which we set up the event listener for events from the other components using the decorator’s <code>onEvent</code> method (lines 5 and 11-13)</li>
<li>We implement an action in <code>onFormEvent()</code> to be triggered (here, the reset of the form) whenever a <code>CLEAR</code> event is received (this could have been accomplished with less code with an <code>if</code>, but I wanted to show all the available event types).</li>
</ol>
<p>We’ve looked now at the templates in the beginning, dug into the component TypeScript code and then developed the class decorator <code>@FormSync</code> and looked how a form component would use it to communicate. What’s missing is how the embedding class uses the decorator to pull all the functionaiity together, as we’ve seen in the very first listing which shows the buttons to submit and clear the form. The corresponding component class looks like this:</p>
<figcaption class="code-filename typescript">app.component.ts</figcaption>

<pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AppComponent</span> <span class="token keyword">extends</span> <span class="token class-name">FormSyncInterface</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
@<span class="token function">FormSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> FormSyncInterface <span class="token punctuation">{</span>

  <span class="token keyword">public</span> aggregateData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> permitStoringForm <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onFormEvent<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeFormValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">initializeFormValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>aggregateData <span class="token operator">=</span> <span class="token punctuation">{</span>
      band<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      user<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">onFormEvent</span><span class="token punctuation">(</span>formEvent<span class="token punctuation">:</span> FormEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>formEvent<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> FormEventType<span class="token punctuation">.</span>DATA_UPDATE<span class="token punctuation">:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSaveButtonState</span><span class="token punctuation">(</span>formEvent as FormDataEntryEvent<span class="token operator">&lt;</span><span class="token keyword">any</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> FormEventType<span class="token punctuation">.</span>CLEAR<span class="token punctuation">:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeFormValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>permitStoringForm <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">setSaveButtonState</span><span class="token punctuation">(</span>formData<span class="token punctuation">:</span> FormDataEntryEvent<span class="token operator">&lt;</span><span class="token keyword">any</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>formData<span class="token punctuation">.</span>isValid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>type<span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token operator">...</span>dataStoreData<span class="token punctuation">}</span> <span class="token operator">=</span> formData<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>aggregateData<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> dataStoreData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aggregateData<span class="token punctuation">[</span>formData<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> aggData <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>aggregateData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>permitStoringForm <span class="token operator">=</span> <span class="token punctuation">(</span>aggData<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isValid<span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span> as <span class="token keyword">boolean</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">isValid</span><span class="token punctuation">(</span>current<span class="token punctuation">:</span> <span class="token keyword">boolean</span><span class="token punctuation">,</span> section<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">boolean</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> current <span class="token operator">&amp;&amp;</span> section<span class="token punctuation">.</span>isValid<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">storeFormData</span><span class="token punctuation">(</span>clickEvent<span class="token punctuation">:</span> MouseEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dataObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> prop <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aggregateData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aggregateData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dataObj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aggregateData<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">.</span>formData<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'storing form data'</span><span class="token punctuation">,</span> dataObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">ClearForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token function">clearFormContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">boolean</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'Really Delete?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>A lot going on, so let’s take a look:</p>
<ol>
<li>We also decorate with the <code>@FormSync</code> decorator here and implement the appropriate interface to keep TypeScript happy</li>
<li>We create a data properties to hold all the form’s data (<code>aggregateData</code>) as well as its validity status in <code>permitStoringForm</code>.</li>
<li>We then set up an event handler, <code>onFormEvent()</code>, which acts on the events to clear the form or whenever a form component emits a new value.</li>
<li>Whenever there is an update to the data, we en- or disable the “Save” button of the form through the <code>setSaveButtonState()</code> method, which iterates over the form settings in <code>aggregateData</code> with a <code>reduce</code> function.</li>
<li>When the user presses the button to store the data, we cumulate the data in all the subforms “manually” into an object, which we in this case simply log out to the console instead of sending it to a server.</li>
</ol>
<p>The final method is decorated with a <em>method decorator</em> and simply returns a boolean — The result of asking the user for confirmation. The <code>@ClearForm</code> decorator wraps this method body and looks as follows:</p>
<figcaption class="code-filename typescript">form-sync.trait.ts</figcaption>

<pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ClearForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> MethodDecorator <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span> target<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">,</span> descriptor<span class="token punctuation">:</span> PropertyDescriptor <span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> origMethod <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    descriptor<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>parameters<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> origMethod<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token keyword">true</span><span class="token punctuation">)</span> target<span class="token punctuation">.</span><span class="token function">clearForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> descriptor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>It gets passed as the first parameter the <code>target</code> — a reference to the decorated class, which contains the decorated method. It then saves a reference to that method before overwriting its definition with a function that </p>
<ul>
<li>calls the original method and stores the result. Since this is a decorator for a method clearing the form, a boolean, on whether the user really wants to delete all entries makes sense, so the result is a boolean.</li>
<li>If the return value of the method in the component class is <code>true</code>, it proceeds to call the <code>clearForm()</code> method on the class, which as we saw is provided by our class decorator.</li>
</ul>
<p>With the functionality of this decorator now clear, the implementation of the <code>clearFormContent()</code> method on the component class should now make sense.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>In this post I have described how TypeScript Decorators can be used to group functionality into a coherent entity that can be mixed into Classes using TypeScript’s Decorator feature. Expanding on <a href="/typescript/typescript-decorator-principles-use-cases/">a previous post</a> we saw how method and class decorators can act together to provide mixable entities in our system that are reminiscent of <em>Scala Traits</em>.</p>
<p>The code developed in this post is <a href="https://bitbucket.org/tmuller/decorator-traits/src/master/" target="_blank" rel="noopener">available in bitbucket</a>.</p>
</article><span class="prev-post"><a href="/typescript/typescript-decorator-principles-use-cases/" itemprop="url">⇐ Previous Post</a></span></div></main><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-697637-4');ga('send','pageview');
</script><script>let crystalDrawings = [
  'albit.svg', 'apatit.svg', 'axinit.svg', 'benitoit.svg', 'beryll.svg', 'boracit.svg',
  'cahnit.svg', 'calcit.svg', 'calcit2.svg', 'calciumthiosulfat.svg', 'chalkopyrit.svg',
  'dioptas.svg', 'dolomit.svg', 'galenit.svg', 'granat.svg', 'hamatit.svg',
  'hemimorhpit.svg', 'iodsuccinimid.svg', 'natriumperiodat.svg', 'rohrzucker.svg',
  'sodiumchlorate.svg', 'struvit.svg', 'sulfur.svg', 'topas-top.svg', 'topas.svg',
  'weinsaure.svg', 'wulfenit.svg', 'wurtzit.svg', 'zinkblende.svg', 'zirkon.svg'
];
const selection = Math.floor(Math.random() * crystalDrawings.length);
const crystalFileName = '/images/crystals/' + crystalDrawings[selection];
//console.log(selection, crystalDrawings[selection], crystalFileName);
document.getElementById('crystal-container').style.backgroundImage = 'url('+ crystalFileName + ')';</script><script src="/scripts/toc.js" type="text/javascript"></script><script>TocGenerator.renderInto()</script></body></html>